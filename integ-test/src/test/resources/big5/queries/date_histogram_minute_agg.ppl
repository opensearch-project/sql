/*
{
  "name": "date_histogram_minute_agg",
  "operation-type": "search",
  "index": "{{index_name | default('big5')}}",
  "body": {
    "size": 0,
    "query": {
      "range": {
        "@timestamp": {
          "gte": "2023-01-01T00:00:00",
          "lt": "2023-01-03T00:00:00"
        }
      }
    },
    "aggs": {
      "by_hour": {
        "date_histogram": {
          "field": "@timestamp",
          {% if distribution_version.split('.') | map('int') | list < "6.0.0".split('.') | map('int') | list or distribution_version.split('.') | map('int') | list >= "7.0.0".split('.') | map('int') | list %}
            "calendar_interval": "minute"
          {% else %}
            "interval": "minute"
          {% endif %}
        }
      }
    }
  }
}
*/
source = big5
| where `@timestamp` >= '2023-01-01 00:00:00' and `@timestamp` < '2023-01-03 00:00:00'
| stats count() by span(`@timestamp`, 1m)